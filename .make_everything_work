#!/usr/bin/env bash
# 
# Make everything work how I like
# 
# This is idempotent.

echo "Starting..."

# Install homebrew if not there
if test ! $(which brew); then
    echo "Installing homebrew..."
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# Update homebrew recipes
brew update

# Install alternative cask
brew tap homebrew/cask-versions

# Install GNU core utilities (those that come with OS X are outdated)
brew install coreutils

# Install latest version of bash
echo "Installing latest verion of bash ü§∑‚Äç‚ôÇÔ∏è"
brew install bash

PACKAGES=(
    readline
    git
    tmux
    direnv
    watch
    rbenv
    pyenv
    stern
    cowsay
    fortune
    postgresql
    yarn
    kubernetes-cli
    awscli
)

echo "Installing your favourite packages..."
brew install ${PACKAGES[@]}

CASKS=(
    visual-studio-code
    homebrew/cask-versions/iterm2-nightly
    1password-cli
    aerial
    insomnia
    docker-edge
    firefox
    spotify
    spotify-notifications
    dash3
    slack
    postico
)

echo "Installing your favourite apps..."
brew cask install ${CASKS[@]}

echo "Cleaning up..."
brew cleanup

# echo "Installing fonts..."
# brew tap caskroom/fonts
# FONTS=(
#     font-inconsolidata
#     font-roboto
#     font-clear-sans
# )
# brew cask install ${FONTS[@]}

# echo "Installing Ruby gems..."
# RUBY_GEMS=(
# )
# sudo gem install ${RUBY_GEMS[@]}

echo "Configuring macOS..."

# Autohide dock
defaults write com.apple.dock autohide -bool true
# Autohide menubar
defaults write NSGlobalDomain _HIHideMenuBar -bool true

# Set fast key repeat rate
defaults write -g InitialKeyRepeat -int 10
defaults write -g KeyRepeat -int 3

# Require password as soon as screensaver or sleep mode starts
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

# Show filename extensions by default
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Turn on key repeat when holding a button down
defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

# Restart dock & finder
killall Finder
killall Dock
echo ""
echo "Done"
echo ""
echo "
NOTE: Make sure to add bash to your list of acceptable shells:
    \`echo "/usr/local/bin/bash" | sudo tee -a /etc/shells\`
"
echo "Restart your terminal"
