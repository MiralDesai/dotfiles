#!usr/bin/env bash
# 
# Make everything work how I like
# 
# This is idempotent.

echo "### Starting..."

# Install homebrew if not there
if test ! $(which brew); then
    echo "Installing homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Update homebrew recipes
brew update

# Install alternative cask
brew tap homebrew/cask-versions

# Install GNU core utilities (those that come with OS X are outdated)
brew install coreutils

# Install latest version of bash
echo "### Installing latest verion of bash ðŸ¤·"
brew install bash

#Install Zsh & Oh My Zsh
echo "### Installing Oh My ZSH..."
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --keep-zshrc

echo "### Setting ZSH as shell..."
chsh -s /bin/zsh

PACKAGES=(
    readline
    git
    tmux
    watch
    rbenv
    pyenv
    nvm
    stern
    cowsay
    fortune
    postgresql
    yarn
    awscli
    fzf
    vim
    eza
    bat
    pure
)
# kubernetes-cli

echo "### Installing your favourite packages..."
brew install ${PACKAGES[@]}

CASKS=(
    visual-studio-code
    iterm2
    1password-cli
    1password
    aerial
    firefox
    spotify
    postico
    standard-notes
    slack
    obsidian
    vlc
    whatsapp
    tempbox
    microsoft-edge
    raycast
    authy
    discord
    flux
    mailspring
    openmtp
    the-unarchiver
    appcleaner
)
# docker
# maccy in the future?

echo "### Installing your favourite apps..."
brew install --cask ${CASKS[@]}

echo "### Installing fonts..."
brew tap homebrew/cask-fonts
FONTS=(
    font-hack
)
brew install --cask ${FONTS[@]}

# echo "Installing Ruby gems..."
# RUBY_GEMS=(
# )
# sudo gem install ${RUBY_GEMS[@]}

echo "### Cleaning up..."
brew cleanup

echo "Configuring macOS..."

# Autohide dock
defaults write com.apple.dock autohide -bool true
# Autohide menubar
defaults write NSGlobalDomain _HIHideMenuBar -bool true

# Set fast key repeat rate
defaults write -g InitialKeyRepeat -int 15
defaults write -g KeyRepeat -int 3

# Require password as soon as screensaver or sleep mode starts
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

# Show filename extensions by default
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Turn on key repeat when holding a button down
defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

# Disable annoying backswipe in Chrome
defaults write com.google.Chrome AppleEnableSwipeNavigateWithScrolls -bool false

# Disable annoying backswipe in Firefox
defaults write org.mozilla.firefox AppleEnableSwipeNavigateWithScrolls -bool false

# Restart dock & finder
killall Finder
killall Dock
echo ""
echo "Done"
echo ""
echo "
NOTE: Make sure to add bash to your list of acceptable shells:
    \`echo "/usr/local/bin/bash" | sudo tee -a /etc/shells\`
"
echo "Restart your terminal"


# $(brew --prefix)/opt/fzf/install -- run this somewhere

# --- future plans if possible ---
#
# setup mac touchpad/keyboard settings
# add appcleaner if available on homebrew
# vim setup here?
#
# make more resiliant, dont throw errors if already installed
